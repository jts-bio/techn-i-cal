{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% load tags %}


{% block style %}

<style>
    html {
        background-image: url("https://media.discordapp.net/attachments/1005308963539144787/1006788342375002112/jsteinbecker_A_perfectly_organized_intricate_Shelf_of_Pharmacy__648fc089-4639-4b07-a6f5-162c5be33e98.png");
        background-repeat: repeat;
        background-size: 20%;
    }

    .btn-coral {
        background-color: coral!important;
        color: white!important;
        margin-bottom: 7px;
    }

</style>

{% endblock style %}


{% block content %}

    
    {% block spinner %} {% endblock spinner %}
        

<div class="text-center">

</div>


<div class="badge badge badge-primary" style="float:right;"> <a href="/sch/docs/week/"> Need Help?</a></div>

<div class="hstack" style="width:100%;justify-content:space-evenly;">

    <a href="/sch/week/{{prevYear}}/{{prevWeek}}/">
        {% backArrow %}</a>

    <div class="vstack" style="align-items:center;">
        <h1 class="text-3xl"> Week {{week_num}} </h1>
        <a href="/sch/pay-period/{{year}}/{{pay_period}}/">
            <h2 class="btn btn-sm btn-coral"> PAY PERIOD {{pay_period}} </h2>
        </a>
    </div>

    <a href="/sch/week/{{nextYear}}/{{nextWeek}}/">
        {% forwardArrow %}</a>

</div>

{% if messages %}
<div class="vstack">
    <div class="flex p-4 mb-4 text-sm text-blue-600 bg-blue-900 rounded-lg w-fc" role="alert">
        <svg aria-hidden="true" class="flex-shrink-0 inline w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clip-rule="evenodd"></path>
        </svg>
        <span class="sr-only">Info</span>
        <div>
            <span class="font-medium">SwapBot</span>
            <ul class="mt-1.5 ml-4 text-blue-700 list-disc list-inside">
                {% for message in messages %}
                <li>{{message}}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}

<div class="panel hstack" style="justify-content:space-between;">

    <div class="tooltip" data-tip="Weekly Shift Preference Score">
        <div class="radial-progress" style="--value:{{weekprefScore}};background-color:rgb(22, 25, 30)">
            {% favoriteIcon %} <span class="text-xs">{{weekprefScore}}%</span>
        </div>
    </div>

    {% if total_unfilled != 0 %}

    <a href="unfilled-slots/">
        <div class="vstack light-button" style="align-items:center;
                    border:1px solid #aaa3;
                    padding:10px 20px 10px 20px;
                    border-radius:6px;gap:1px;">
            <span style="padding:0px;margin:0px;">
                {{total_unfilled}} unfilled slots for this week</span>
            <span style="font-size:9px;letter-spacing:1.5px;">
                CLICK TO MANAGE</span>
        </div>
    </a>

    {% endif %}

    {% if pto_requests %}
    <div class="vstack light-button" style="align-items:center;
                    border:1px solid #aaa3;
                    padding:10px 20px 10px 20px;
                    border-radius:6px;gap:1px;">
        <span style="padding:0px;margin:0px;">
            {{pto_requests|length}} PTO requests</span>
        <span style="font-size:9px;letter-spacing:1.5px;">
            CLICK TO MANAGE</span>
    </div>
    {% endif %}

    {% if messages %}{% if "popover" in messages.tags %}
    <button data-popover-target="popover-default" type="button"
        class="text-white bg-yellow-700 hover:bg-yellow-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-yellow-600 dark:hover:bg-yellow-700 dark:focus:ring-blue-800">VIEW
        MESSAGES</button>
    <div data-popover id="popover-default" role="tooltip"
        class="inline-block absolute invisible z-10 w-64 text-sm font-light text-gray-500 bg-white rounded-lg border border-gray-200 shadow-sm opacity-0 transition-opacity duration-300 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
        <div class="py-2 px-3 bg-gray-100 rounded-t-lg border-b border-gray-200 dark:border-gray-600 dark:bg-gray-700">
            <h3 class="font-semibold text-gray-900 dark:text-white">Message from ShiftSwap bot</h3>
        </div>
        <div class="py-2 px-3">
            <p>{% for message in messages %} {{message}} <br>{% endfor %}</p>
        </div>
        <div data-popper-arrow></div>
    </div>
    {% endif %}{% endif %}

    <a href="table/">View Table</a>

    <div class="vstack" style="align-items:center;float:end;">
        
        <div class="hstack">
            
            <div class="tooltip" data-tip="FILL Templated Slots">
                <a class="btn btn-neutral" href="fill-template/">
                    {% fillTemplateIcon %} </a>
            </div>
           

            <div class="tooltip" data-tip="RUN Assignment Solver">
                <a class="btn btn-neutral" 
                   id="solve-button"
                   href="solve/"
                   >
                    {% robotIcon %} </a>
            </div>

            <div class="tooltip" data-tip="SORT & SWAP To Improve Schedule">
                <a class="btn btn-neutral" color="text-accent" href="swap-bot/">
                    {% sortingHatIcon %}
                </a>
            </div>

            <div class="tooltip" data-tip="CLEAR & RETRY Low Preference Slots">
                <a href="clear-low-score-slots/" class="btn btn-neutral"
                    style="background-color:rgb(71, 59, 26);color:rgb(255, 255, 255);">
                    {% posionIcon %}
                </a>
            </div>

            <div class="tooltip" data-tip="CLEAR All Slots This Week">
                <a class="btn btn-danger" href="clear-slots-form/"
                    style="background-color:rgb(69, 10, 11);color:rgb(235, 235, 235);">
                    {% clearIcon %}
                </a>
            </div>
        </div>

        <div class="text-2xs">TOOLBOX </div>

    </div>

</div>

<script>
    function showLoader () {
        var loaders = document.getElementById('#solve-button');
        loaders.style.display = "inline";
        loaders.style.hidden = "false";
        })
    }
</script>

<div class="hstack" style="justify-content:space-between;">
    {% for day in workdays %}
    <div class="panel inline-flex relative vstack p-3 text-sm font-medium text-center text-white" style="height:510px;">
        {%if day.nPTO %}
        <div
            class="inline-flex absolute -top-2 -right-2 justify-center items-center w-6 h-6 text-xs text-white bg-blue-500 rounded-full border-2 border-white dark:border-gray-900">
            <div class="tooltip" data-tip="PTO: {{day.PTO}}">{{day.nPTO}}</div>
        </div>
        {%endif%}
        <h3 style="color:orange;font-family:Raleway;font-size:24px;">
            <a href="/sch/day/{{day.slug}}"> {{day.date}} </a>
        </h3>
        <div class="overflow-x-auto">
            {{ day.table }}
        </div>
        <div class="tooltip" data-tip="Employee avg Shift Preference">
            <span class="badge badge-xs" style="background-color:darkslateblue;color:black;">
                {% favoriteIcon '10px' '10px' '#333333' %}
                {{day.prefScore}}%
            </span>
        </div>

    </div>
    {% endfor %}
</div>

<div class="panel w-fc mt-10" style="width:100%;background-color:#abf2;">
    <div class="hstack">
        <h3>Weekly Hours</h3>
    </div>
    <div class="grid-4-row">
        {% for empl in hrsTable %}
        <div class="form-control">

            <label class="label">
                <span class="label-text"><a
                        href="/sch/employee/{{empl.0}}/generate-schedule/{{dateFrom}}/{{dateTo}}/"></span>
            </label>
            <label class="input-group">
                {% if empl.1.hours <= 40 %} <div class="btn btn-neutral"> {{ empl.1.hours }} hr
            </label>
        </div>
        {% elif empl.1.hours == None %}
        <div class="btn bg-gray-600" style="color:white;">0 hr</div>
        {% else %}
        <div class="btn bg-red-600" style="color:white;"> {{ empl.1.hours }} hr</div>
        {% endif %}
        <span style="font-size:10px;"> {{empl.0 }}<br></span>
        <label>
            <span
                class="bg-indigo-100 text-indigo-800 text-sm font-semibold mr-2 px-2.5 py-0.5 rounded dark:bg-indigo-200 dark:text-indigo-900">
                <sup class="text-indigo-400">PTO</sup><br>{{empl.2}}
            </span> </span>
        </label>
        </a>

    </div>
    {% endfor %}
    
    

</div>
<div class="panel">
    <h2 class="text-2xl font-bold">Unfavorable Shifts</h2>
    <div class="hstack" style="flex-wrap: wrap;justify-content:space-around;">
    {% for count,empls in unfavorables.items %}
    <div style='width:22%'>
        {% iconCard2 count  empls  %}
    </div>
    {% endfor %}
    </div>
        
</div>

</div>



</div>


<script src="https://unpkg.com/htmx.org@1.8.2" integrity="sha384-+8ISc/waZcRdXCLxVgbsLzay31nCdyZXQxnsUy++HJzJliTzxKWr0m1cIEMyUzQu" crossorigin="anonymous"></script>



{% endblock content %}