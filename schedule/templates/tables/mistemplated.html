

<div class="text-2xl font-bold bg-zinc-950 text-amber-400 italic rounded w-fc px-4">Mistemplated Slots</div>

<p class="text-xs my-2 jbm text-amber-200 w-4/6">Mistemplated slots are those which have an employee
    templated in the standard template schedule, but are instead filled another
    employee. Slots are not considered mistemplated if the usual employee has
    a PTO request on the day in question.</p>


<div class="bg-zinc-400 text-zinc-900 text-xs px-2 rounded-full hover:bg-sky-600 cursor-pointer w-fc my-2"
    hx-post="actions/retemplate-all/"
    hx-trigger="click"
    hx-target="#swap-panel"
    hx-indicator="#retemplateIndicator">
    Retemplate All 
</div>

<span id="retemplateIndicator" class="htmx-indicator fa-duotone fa-spinner animate-spin"></span>

<table>
    <tr>
        <th>Day</th>
        <th>Employee</th>
        <th>Actions</th>
        <th>Template</th>
    </tr>
    {% if data|length > 0 %}
    {% for slot in data %}
    <tr>
        <td>
            <a class="bg-transparent" 
               href="wd/{{ slot.workday }}">{{ slot.workday }} {{ slot.shift }}</a>
        </td>
        <td>
            <div class="current-empl py-1 pl-2 rounded-sm bg-zinc-300 text-zinc-900">{{ slot.employee }}</div>
        </td>
        <td> 
            <span class="swap-btn" 
                 hx-post="actions/override-slot/{{ slot.workday }}/{{ slot.shift }}/{{ slot.template_employee }}/"
                 hx-trigger="click" 
                 hx-swap="innerHTML"
                 data-tmplt="{{ slot.template_employee}}"
                 _="on click hide the next .bell-btn
                    then put @data-tmplt into previous .current-empl 
                    then add .bg-emerald-200 to previous .current-empl">
                <i class="fa-light fa-arrow-turn-down-left hover:fa-solid hover:text-emerald-300" 
                    title="Swap In Templated Employee ({{ slot.template_employee }})"></i>
            </span>
            <span class="bell-btn"
                hx-get="/api/slot/{{ slot.slug }}/actions/ignore-mistemplate/"
                _="on click hide the previous .swap-btn
                   then add .bg-amber-300 to previous .current-empl 
                   then put `` into next <td/> end">
                <i class="fa-solid fa-bell-slash hover:text-orange-300" 
                   title="Ignore Mistemplated Flag"></i>
            </span>
        </td>
        <td>{{ slot.template_employee }}</td>
    </tr>
    {% endfor %}
    {% endif %}
</table>

<h3 class="text-lg font-bold my-3">Ingnoring warning on:</h3>
{% for slot in ignoring_mistemplate %}

<div class="py-1 px-2 rounded bg-amber-900 mx-2 my-2 inline-block hover:bg-amber-500 ignore-flag">
    {{ slot.employee }} {{ slot.workday.date.month }}/{{ slot.workday.date.day }}
    <span _="on click 
                fetch /api/slot/{{slot.slug}}/actions/flag-mistemplate/ 
                then remove closest .ignore-flag
                then send recheck to #mistmpl
                then fetch /schedule/partials/{{slot.schedule.slug}}/mistemplated/ 
                then put result into #swap-panel
            end"
          class="fa-solid fa-times text-xl hover:text-amber-600 pointer-cursor">
    </span>
</div>

{% endfor %}


<script type="text-pug">
    
</script>